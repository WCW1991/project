#include "Standy_Display.h"

DisplayType_enum DisplayType;

static void __DisplayFault( Fault_Device_List_struct *List_Tail, uint16_t fault_index, uint8_t Index );

const uint8_t Standy_BMP[] = 
{
#if (PROGRAM_TYPE == 1)
		0x80, 0x10, 0x20, 0x00, 0x90, 0xA0, 0x80, 0xF8, 0x80, 0xA0, 0x90, 0x00, 0xF0, 0x10, 0x90, 0x70,
		0x20, 0x20, 0xE8, 0x30, 0x20, 0x20, 0x20, 0x00, 0x80, 0x88, 0x90, 0x00, 0x80, 0x78, 0x08, 0x08,
		0x78, 0x80, 0x80, 0x00, 0x00, 0x20, 0x90, 0xB8, 0x50, 0x50, 0x50, 0xB0, 0x90, 0x00, 0x00, 0x00,
		0xE0, 0x20, 0x20, 0x20, 0xF8, 0x20, 0x20, 0x20, 0xE0, 0x00, 0x00, 0x00, 0x88, 0x10, 0x00, 0xF8,
		0x08, 0xC8, 0x68, 0x58, 0x48, 0xC8, 0x08, 0x00, 0x20, 0x40, 0xF8, 0x00, 0x80, 0x80, 0x80, 0xF8,
		0x80, 0x90, 0xA0, 0x00, 0x20, 0x20, 0x20, 0xA0, 0x60, 0x38, 0x60, 0xA0, 0x20, 0x20, 0x20, 0x00,
		0x00, 0xF0, 0x00, 0x00, 0xF8, 0x80, 0x40, 0x38, 0xA0, 0x20, 0x20, 0x00, 0x40, 0xF8, 0x40, 0x00,
		0x60, 0x20, 0xA8, 0x30, 0xA0, 0x20, 0x60, 0x00, 0x00, 0x38, 0x28, 0x28, 0x38, 0xC0, 0x38, 0x28,
		0x68, 0xB8, 0x00, 0x00,
		0x20, 0x11, 0x08, 0x00, 0x7F, 0x0A, 0x0A, 0x0A, 0x0A, 0x4A, 0x7F, 0x00, 0x7F, 0x10, 0x11, 0x0E,
		0x40, 0x30, 0x0F, 0x01, 0x41, 0x41, 0x3F, 0x00, 0x00, 0x00, 0x3F, 0x10, 0x42, 0x46, 0x2A, 0x12,
		0x2A, 0x46, 0x40, 0x00, 0x01, 0x01, 0x7E, 0x2A, 0x2A, 0x3E, 0x2A, 0x2A, 0x7E, 0x01, 0x01, 0x00,
		0x1F, 0x09, 0x09, 0x09, 0x3F, 0x49, 0x49, 0x49, 0x4F, 0x40, 0x70, 0x00, 0x20, 0x11, 0x40, 0x3F,
		0x20, 0x17, 0x45, 0x7D, 0x05, 0x17, 0x20, 0x00, 0x08, 0x04, 0x7F, 0x00, 0x40, 0x30, 0x0E, 0x01,
		0x0E, 0x30, 0x40, 0x00, 0x22, 0x1A, 0x01, 0x38, 0x40, 0x45, 0x5A, 0x40, 0x61, 0x0A, 0x32, 0x00,
		0x40, 0x7C, 0x44, 0x44, 0x7D, 0x44, 0x7C, 0x44, 0x44, 0x7D, 0x40, 0x00, 0x44, 0x7F, 0x02, 0x00,
		0x42, 0x45, 0x44, 0x7C, 0x44, 0x45, 0x42, 0x00, 0x09, 0x79, 0x55, 0x55, 0x73, 0x01, 0x73, 0x55,
		0x55, 0x79, 0x09, 0x00,
#endif
#if (PROGRAM_TYPE == 2)
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xE0, 0x20, 0x20, 0x20, 0xF8, 0x20, 0x20, 0x20,
		0xE0, 0x00, 0x00, 0x00, 0x40, 0x20, 0x58, 0x50, 0x50, 0x50, 0x50, 0x50, 0x50, 0x50, 0x10, 0x00,
		0x00, 0x00, 0xE0, 0x00, 0x00, 0xF8, 0x00, 0x00, 0x80, 0x60, 0x00, 0x00, 0x60, 0x20, 0x20, 0x20,
		0x28, 0xB0, 0x20, 0x20, 0x20, 0x20, 0x60, 0x00, 0x00, 0xF0, 0x00, 0x00, 0xF8, 0x80, 0x40, 0x38,
		0xA0, 0x20, 0x20, 0x00, 0x40, 0xF8, 0x40, 0x00, 0x60, 0x20, 0xA8, 0x30, 0xA0, 0x20, 0x60, 0x00,
		0x80, 0x88, 0x90, 0x00, 0x80, 0x78, 0x08, 0x08, 0x78, 0x80, 0x80, 0x00, 0x00, 0x20, 0x90, 0xB8,
		0x50, 0x50, 0x50, 0xB0, 0x90, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0x09, 0x09, 0x09, 0x3F, 0x49, 0x49, 0x49,
		0x4F, 0x40, 0x70, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x1F, 0x20, 0x70, 0x00,
		0x40, 0x41, 0x20, 0x18, 0x06, 0x01, 0x06, 0x18, 0x20, 0x40, 0x40, 0x00, 0x40, 0x44, 0x23, 0x10,
		0x0C, 0x03, 0x0C, 0x10, 0x24, 0x43, 0x40, 0x00, 0x40, 0x7C, 0x44, 0x44, 0x7D, 0x44, 0x7C, 0x44,
		0x44, 0x7D, 0x40, 0x00, 0x44, 0x7F, 0x02, 0x00, 0x42, 0x45, 0x44, 0x7C, 0x44, 0x45, 0x42, 0x00,
		0x00, 0x00, 0x3F, 0x10, 0x42, 0x46, 0x2A, 0x12, 0x2A, 0x46, 0x40, 0x00, 0x01, 0x01, 0x7E, 0x2A,
		0x2A, 0x3E, 0x2A, 0x2A, 0x7E, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00,
#endif
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x90, 0xD0,
		0xB0, 0x90, 0x88, 0x88, 0x48, 0x08, 0x00, 0x00, 0xC0, 0xA0, 0x98, 0x40, 0x00, 0x20, 0xA0, 0x68,
		0x30, 0xA0, 0x20, 0x00, 0x00, 0x10, 0x10, 0x10, 0x10, 0xF0, 0x10, 0x10, 0x10, 0x10, 0x00, 0x00,
		0x60, 0x20, 0xA8, 0xB0, 0xA0, 0xB8, 0xA0, 0xB0, 0xA8, 0x20, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x24, 0x14, 0x06,
		0x46, 0x7D, 0x05, 0x04, 0x14, 0x26, 0x4C, 0x00, 0x24, 0x26, 0x15, 0x14, 0x40, 0x23, 0x1E, 0x02,
		0x3E, 0x42, 0x67, 0x00, 0x40, 0x40, 0x7F, 0x40, 0x40, 0x7F, 0x42, 0x42, 0x42, 0x42, 0x40, 0x00,
		0x00, 0x38, 0x0B, 0x0A, 0x0A, 0x7E, 0x0A, 0x0A, 0x2B, 0x38, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00
};

void Standy_Display( void )
{
	uint8_t  err;
	
	switch(DisplayType){
	case StandyFire:{
		if(Precedence_Fault_Total_Number){
			Clean_Lcd(ScreenBuffer);
			OSFlagPost(FLAG_GRP,DisplayDateTimeFlag,OS_FLAG_CLR,&err);
#if (PROGRAM_TYPE == 1)
			StringDisplay( "¹Ê", 0, 0, 1, ScreenBuffer );
			StringDisplay( "ÕÏ", 2, 0, 1, ScreenBuffer );
			StringDisplay( "Êý", 4, 0, 1, ScreenBuffer );
#else
			StringDisplay( "±¨", 0, 0, 1, ScreenBuffer );
			StringDisplay( "¾¯", 2, 0, 1, ScreenBuffer );
			StringDisplay( "Êý", 4, 0, 1, ScreenBuffer );
#endif
			DisplayValueN( Precedence_Fault_Total_Number, 6, 0, 1, 3, ScreenBuffer);
			if(Precedence_Fault_Total_Number==1){
				Precedence_Fault_Display_Index = 0;
				__DisplayFault(Precedence_Fault_Device_Tail, Precedence_Fault_Display_Index, 1 );
			}else{
				if(Precedence_Fault_Display_Index >= Precedence_Fault_Total_Number)
				{
					Precedence_Fault_Display_Index = 0;
				}
				__DisplayFault( Precedence_Fault_Device_Tail, Precedence_Fault_Display_Index, 1 );
				if(Precedence_Fault_Display_Index+1 >= Precedence_Fault_Total_Number)
				{
					__DisplayFault( Precedence_Fault_Device_Tail, 0, 2 );
				}
				else __DisplayFault( Precedence_Fault_Device_Tail, Precedence_Fault_Display_Index+1, 2 );
			}
		}else{
			Clean_Lcd(ScreenBuffer);
			StringDisplay( "µçÔ´ÖÐ¶Ï»Ö¸´", 2, 48, 0, ScreenBuffer );
			OSTimeDlyHMSM(0,0,0,100);
			if(Fault_Total_Number)
				DisplayType=StandyFault;
			else
				DisplayType=StandyNomal;
		}
	}break;
	case StandyFault:{
		if(Fault_Total_Number){
			Clean_Lcd(ScreenBuffer);
			OSFlagPost(FLAG_GRP,DisplayDateTimeFlag,OS_FLAG_CLR,&err);
			StringDisplay( "¹Ê", 0, 0, 1, ScreenBuffer );
			StringDisplay( "ÕÏ", 2, 0, 1, ScreenBuffer );
			StringDisplay( "Êý", 4, 0, 1, ScreenBuffer );
			DisplayValueN( Fault_Total_Number, 6, 0, 1, 3, ScreenBuffer);
			if(Fault_Total_Number==1){
				Fault_Display_Index = 0;
				__DisplayFault(Fault_Device_Tail, Fault_Display_Index, 1 );
			}else{
				if(Fault_Display_Index >= Fault_Total_Number)
				{
					Fault_Display_Index = 0;
				}
				__DisplayFault(Fault_Device_Tail, Fault_Display_Index, 1 );
				if(Fault_Display_Index+1 >= Fault_Total_Number)
				{
					__DisplayFault( Fault_Device_Tail, 0, 2 );
				}
				else __DisplayFault( Fault_Device_Tail, Fault_Display_Index+1, 2 );
			}
		}else{
			Clean_Lcd(ScreenBuffer);
			StringDisplay( "¹ÊÕÏ»Ö¸´", 2, 48, 0, ScreenBuffer );
			OSTimeDlyHMSM(0,0,0,100);
			if(Precedence_Fault_Total_Number)
				DisplayType=StandyFire;
			else
				DisplayType=StandyNomal;
		}
	}break;
	case StandyNomal:{
		if(Precedence_Fault_Total_Number||Fault_Total_Number){
			if(Precedence_Fault_Total_Number){
				DisplayType=StandyFire;
				return;
			}else{
				DisplayType=StandyFault;
				return;
			}
		}else{
			Clean_Lcd(ScreenBuffer);
			OSFlagPost(FLAG_GRP,DisplayDateTimeFlag,OS_FLAG_SET,&err);

			Bmp_Display((uint8_t *)Standy_BMP, 2, 28, 4, 132, ScreenBuffer);
			DisplaySystime(systime, 6, ScreenBuffer);
		}
	}break;
	}
}

static void __DisplayFault( Fault_Device_List_struct *List_Tail, uint16_t fault_index, uint8_t Index )
{
	uint16_t i = 0;
	TypeDef_Fault_Display_t fault;
	Fault_Device_List_struct *fault_display;
	
	fault_display = List_Tail->next;
	for(i=0; i<fault_index; i++)
	{
		fault_display = fault_display->next;
	}
	
	fault.CardAddress = fault_display->CardAddress;
	fault.DetectorAddress = fault_display->DetectorAddress;
	fault.DetectorChannel = fault_display->DetectorChannel;
	fault.Event_Type = fault_display->Event_Type;
	fault.Fault_Type = fault_display->Fault_Type;
	fault.Fault_Type_Dsc = fault_display->Fault_Type_Dsc;
	fault.time = fault_display->time;
	display_fault(fault_index+1, &fault, Index);
}